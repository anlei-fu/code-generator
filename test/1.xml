<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<mapper namespace="com.qianxingniwo.information.mapper.SummaryMapper">
  <select id="getSummary" parameterType="com.qianxingniwo.information.pojo.parameters.SummeryParameter" resultType="com.qianxingniwo.information.pojo.model.SummaryItemModel">
    &#xD;
        select&#xD;
        count(*) as count ,&#xD;
        t1.receiving_unit as division_name,&#xD;
        t1.receiving_workarea_info as division_code&#xD;
        from damage_repository t1&#xD;
        inner join damage_repository_device t2 on t1.order_detail_id= t2.order_detail_id&#xD;
        where&#xD;
        1=1&#xD;
&#xD;
        &#xD;
&#xD;
        &#xD;
&#xD;
        &#xD;
&#xD;
        &#xD;
&#xD;
        &#xD;
&#xD;
        and t1.create_time&gt;#{startTime,jdbcType=TIMESTAMP}&#xD;
        and t1.create_time &lt; #{endTime,jdbcType=TIMESTAMP}&#xD;
        group by t1.receiving_unit ,t1.receiving_workarea_info&#xD;
    
    <if test="damageLevel!=null">&#xD;
            and t1.damage_level =#{damageLevel,jdbcType=INTEGER}&#xD;
        </if>
    <if test="damageOld!=null">&#xD;
            and t1.damage_old=#{damageOld,jdbcType=INTEGER}&#xD;
        </if>
    <if test="defectsExtents!=null">
      &#xD;
            and t1.damage_type in&#xD;
            &#xD;
        
      <foreach collection="defectsExtents" open="(" close=")" separator=",">&#xD;
                #{item,jdbcType=INTEGER}&#xD;
            </foreach>
    </if>
    <if test="dealStatus!=null">&#xD;
            and t1.deal_status=#{dealStatus,jdbcType=INTEGER}&#xD;
        </if>
    <if test="deviceType!=null">&#xD;
            and t2.device_type=#{deviceType,jdbcType=INTEGER}&#xD;
        </if>
  </select>
  <select id="getDivisionDamageDetails" parameterType="com.qianxingniwo.information.pojo.parameters.DivisionSummeryParameter" resultType="com.qianxingniwo.information.pojo.model.DamageDetailModel">
    &#xD;
        select&#xD;
        -- main&#xD;
        t1.order_detail_id,&#xD;
        t1.order_no,&#xD;
        t1.detect_time,&#xD;
        t1.detect_stuff,&#xD;
        t1.damage_type,&#xD;
        t1.damage_level,&#xD;
        t1.damage_detail,&#xD;
        t1.damage_code,&#xD;
        t1.damage_old,&#xD;
        t1.damage_old_id,&#xD;
        t1.receiving_unit,&#xD;
        t1.receiving_user,&#xD;
        t1.remark,&#xD;
        t1.receiving_workarea_info,&#xD;
        t1.deal_status,&#xD;
        t1.import_status,&#xD;
        t1.is_delete,&#xD;
        t1.operator,&#xD;
        t1.cancel,&#xD;
        -- device&#xD;
        t2.device_name,&#xD;
        t2.device_code,&#xD;
        t2.device_type_code,&#xD;
        t2.device_type,&#xD;
        t2.seal_number,&#xD;
        t2.factory,&#xD;
        t2.nature,&#xD;
        t2.total_weight,&#xD;
        t2.user_date,&#xD;
        t2.radius,&#xD;
        t2.sleeper,&#xD;
        t2.rail_type,&#xD;
        -- position&#xD;
        t3.line_id,&#xD;
        t3.line_name,&#xD;
        t3.line_category,&#xD;
        t3.direction,&#xD;
        t3.station_id,&#xD;
        t3.miles,&#xD;
        t3.thigh_track_id,&#xD;
        t3.stock_exchange,&#xD;
        t3.damage_position,&#xD;
        t3.hole_position,&#xD;
        t3.bridge_tunnel,&#xD;
        -- work area&#xD;
        t4.short_name as workarea_name,&#xD;
        -- detect stuff&#xD;
        t5.name as detect_staff_name&#xD;
        from damage_repository t1&#xD;
        inner join damage_repository_device t2 on t1.order_detail_id= t2.order_detail_id&#xD;
        inner join damage_repository_position t3 on t1.order_detail_id= t3.order_detail_id&#xD;
        inner join workarea_info t4 on t1.receiving_workarea_info=t4.id&#xD;
        inner  join detect_staff_info t5 on t1.detect_stuff=t5.id&#xD;
        where&#xD;
        1=1&#xD;
        &#xD;
&#xD;
        &#xD;
&#xD;
        &#xD;
&#xD;
        &#xD;
&#xD;
        &#xD;
&#xD;
        and t1.create_time &gt;#{startTime,jdbcType=TIMESTAMP}&#xD;
        and t1.create_time &lt;#{endTime,jdbcType=TIMESTAMP}&#xD;
        and t1.receiving_unit=#{divisionCode,jdbcType=VARCHAR}&#xD;
    
    <if test="damageLevel!=null">&#xD;
            and t1.damage_level =#{damageLevel,jdbcType=INTEGER}&#xD;
        </if>
    <if test="damageOld!=null">&#xD;
            and t1.damage_old=#{damageOld,jdbcType=INTEGER}&#xD;
        </if>
    <if test="defectsExtents!=null">
      &#xD;
            and t1.damage_type in&#xD;
            &#xD;
        
      <foreach collection="defectsExtents" open="(" close=")" separator=",">&#xD;
                #{item,jdbcType=INTEGER}&#xD;
            </foreach>
    </if>
    <if test="dealStatus!=null">&#xD;
            and t1.deal_status=#{dealStatus,jdbcType=INTEGER}&#xD;
        </if>
    <if test="deviceType!=null">&#xD;
            and t2.device_type=#{deviceType,jdbcType=INTEGER}&#xD;
        </if>
  </select>
</mapper>