<html>
<head>
    <title>contract</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes,height = device-height" />
</head>
<body>
    <script src="/Scripts/jquery-1.4.4.min.js" type="text/javascript"></script>
    <script>
                var query = {
                        BusinessType: "",
                        ChannelType: "",
                        CompanyNo: "",
                        PageIndex: 0,
                        PageSize: 10,
                        Memo:"",
                        PartnerCompanyName:"",
                        startTime:null,
                        endTime:null,
                };

                
                var total = 0;
                var loaded = 0;


                $(() => {
                       
                       query.endTime=  $("#endTime").val();
                       query.startTime=$("#startTime").val();

                        $(".back").click(() => {
                                goToGenerate();
                        });
                        
                        $("#search").click(() => {
                                $(".mask").show();
                                $(".filter").show();

                                $("#companyNo").val(query.CompanyNo);
                                $("#channelType").val(query.ChannelType);
                                $("#businessType").val(query.BusinessType);
                                $("#memo").val(query.Memo);
                                $("#partnerCompanyName").val(query.PartnerCompanyName);

                                if(query.startTime)
                                  $("#startTime").val(query.startTime);

                                if(query.endTime)
                                  $("#endTime").val(query.endTime);
                        });

                        $(".cancel").click(() => {
                                $(".mask").hide();
                                $(".filter").hide();
                        });

                        $(".ok").click(() => {
                                $(".mask").hide();
                                $(".filter").hide();
                                reset();
                                getMore();
                        });

                });
                function goToGenerate() {
                        location.href = "/ContractInfo/Index";
                }

                function reset() {
                        query.PageIndex = 1;
                        query.CompanyNo = $("#companyNo").val();
                        query.ChannelType = $("#channelType").val();
                        query.BusinessType = $("#businessType").val();
                        query.startTime=$("#startTime").val();
                        query.endTime=$("#endTime").val();
                        query.PartnerCompanyName=$("#partnerCompanyName").val();
                        query.Memo=$("#memo").val();
                        $(".item-container").empty();
                        loaded = 0;
                }

                function getMore() {
                        console.log("get more");
                        var params=getParams();
                        console.log(params);
                        $.ajax({
                                url: "/ContractInfo/Query?" +params ,
                                async: false,
                                type: "post",
                                success: (resp) => {
                                        var result = $.parseJSON(resp);
                                        total = result.Total;
                                        render(result.List);
                                },
                                error: () => {

                                }
                        })
                }

                function getParams() {
                        return `businessType=${query.BusinessType}&channelType=${query.ChannelType}&companyNo=${query.CompanyNo}&pageIndex=${query.PageIndex}&startTime=${query.startTime}&endTime=${query.endTime}&partnerCompanyName=${query.PartnerCompanyName}&memo=${query.Memo}`;
                }

                /**
                 * 
                 * param ls array
                 * 
                 */
                function render(ls) {
                        console.log(ls);
                        ls.forEach(x => {
                                x.Memo=x.Memo||"";
                                x.PartnerCompanyName=x.PartnerCompanyName||"";
                                $(` <div class="item">
                                        <div class="item-wrapper">
                                                <p><span class="contract-no">${x.ContractNo}</span>
                                                        <span class="badage-container">
                                                                <span class="channel-type">${x.ChannelTypeName}</span>
                                                                <span class="business-type">${x.BusinessTypeName}</span>
                                                        </span>
                                                </p>
                                                <p class="company"><span >${x.CompanyName}</span>  </p>
                                                <p class="ranmy">${x.PartnerCompanyName}</p>
                                                <p class="ranmy" title="${x.Memo}">${x.Memo}</p>
                                                <p class="ranmy"><span class="date">${x.CreateTime}</span><span class="del" onclick="confirmDelete('${x.ContractNo}')">删除</span></p>
                                        </div>

                        </div>`).appendTo($(".item-container"));
                        });


                        if(query.PageIndex==1&&ls.length==0)
                        {
                           $(".no-data").show();
                        }else{
                           $(".no-data").hide();
                        }

                        loaded += ls.length;
                        query.PageIndex += 1;

                        console.log("total");
                        console.log(total);

                        console.log("loaded");
                        console.log(loaded);

                        if (loaded >= total) {
                                $(".load-more").hide();
                        } else {
                                $(".load-more").show();
                                $("#loader").text(`加载更多(${loaded}/${total})`);
                        }

                        if(loaded>20){
                          $(".goto-top").show();
                        }else{
                        $(".goto-top").hide();
                        }

                        console.log("query");
                        console.log(query);
                }


                var deleteNo;

                function confirmDelete(no){
                   deleteNo=no;
                   $(".mask").show();
                   $(".success-content").val(deleteNo);
                   $(".success-view-container").show();

                }


                $(()=>{
                    
                    $(".copy").click(()=>{
                       $(".mask").hide();
                  
                       $(".success-view-container").hide();

                       $.ajax({
                        url:"",
                        type:"post",
                        async:false,
                        success:(resp)=>{
                           reset();
                           getMore();
                        },
                        error:(err)=>{
                        }
                        
                       });
                    
                    });

                    $(".close").click(()=>{
                    
                     $(".mask").hide();
                  
                     $(".success-view-container").hide();
                    });

                   
                });
    </script>
    <style>
        html
        {
            padding: 0;
            margin: 0;
        }
        
        body
        {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
            background-color: #FAFAFA;
        }
        input{
            -webkit-appearance:none;
            outline:none;
            border:none;
        }
        select{
            -webkit-appearance: none;//这样select默认的样式就没有了，后面的箭头也没有了，自己找个图标添加进去就可以了
            padding-right:30px;//给右边图标留位置
            background: url("arrow.png") no-repeat scroll right center transparent;//放自己的图标
        }
        .search
        {
            border-bottom: 1px solid #B5B6B5;
            padding: 20px;
            text-align: left;
        }
        
        .item-container
        {
            width: 100%;
            margin: 0 auto;
        }
        
        .badage-container
        {
            position: absolute;
            right: 5%;
        }
        
        .contract-no
        {
            font-size: 12px;
            font-weight: bold;
            color: #7B797B;
        }
        
        .item
        {
            background-color: white;
            margin: 10px 0;
            text-align: left;
        }
        
        .company
        {
            color: #8C8A8C;
            font-size: 12px;
            margin-top: 15px;
        }
        .date
        {
            right: 8%;
            
        }
        
        .item-wrapper
        {
            width: 90%;
            margin: 0 auto;
            padding: 10px;
        }
        
        .channel-type
        {
            margin: 5px;
            background-color: #EF9618;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 10px;
            color: white;
        }
        
        .business-type
        {
            margin: 5px;
            background-color: #5ABA5A;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 10px;
            color: white;
        }
        
        .btn
        {
            background-color: white;
            border: 1px solid;
            border-radius: 5px;
            padding: 8px 20px;
            font-size: 12px;
            margin-right: 10px;
            color: #3179B5;
        }
        .back
        {
            background: #3179B5;
            color: #fff;
            border: 1px solid #3179B5;
        }
        .btns
        {
            position: absolute;
            right: 5%;
        }
        
        .load-more
        {
            text-align: center;
            padding: 10px;
            text-decoration: none;
            color: Blue;
            display: none;
        }
        
        .mask
        {
            position: fixed;
            width: 100%;
            height: 100%;
            background-color: rgba(35, 35, 35, 0.35);
            display: none;
            top: 0;
            left: 0;
            z-index: 1000;
        }
        
        
        .row
        {
            width: 100%;
            margin-bottom: 18px;
            font-size: 0;
        }
        
        .container
        {
            width: 100%;
            margin: 0 auto;
        }
        
        .label
        {
            padding: 5px;
            width: 6rem;
            display: inline-block;
            color: #7B797B;
            font-size: 14px;
            line-height: 40px;
            height: 40px;
        }
        
        .text-box
        {
            padding: 6px;
            border-radius: 5px;
            border: 1px solid #7B797B;
            width: 60%;
            margin-left: 0px;
        }
        
        select
        {
            width: 60%;
            padding-left: 6px;
            box-sizing: content-box;
            border-radius: 5px;
            background-color: White;
            margin-left: 0px;
            line-height: 40px;
            height: 40px;
            color: #333;
        }
        
        option
        {
            padding: 6px;
            width: 60%;
            margin-left: 0px;
        }
        
        .filter
        {
            display: none;
            position: absolute;
            top: 50%;
            z-index: 1000;
            left: 50%;
            width: 90%;
            transform: translate(-50% ,-50%);
            background-color: #fff;
            border-radius: 6px;
        }
        .rows
        {
            padding: 20px 15px;
        }
        .buttons
        {
            margin: 0 auto;
            text-align: center;
        }
        .cancel
        {
            background-color: white;
            border: 1px solid;
            border-radius: 5px;
            padding: 8px 20px;
            font-size: 12px;
            margin-right: 10px;
            color: #3179B5;
        }
        .ok
        {
            background-color: #3179B5;
            border-radius: 5px;
            border: none;
            padding: 8px 20px;
            font-size: 12px;
            color: #fff;
        }
        
        .time-wrapper
        {
            display: inline-block !important;
            border: 1px solid;
            border-color: rgb(169, 169, 169);
            min-width:60%;
            border-radius: 5px;
            background-color: White;
            margin-left: 0px;
            line-height: 40px;
            height: 40px;
            font-size: 14px;
            color: #333;
            padding-left: 6px;
        }
        
        a
        {
            text-decoration: none;
            padding: 10px;
            font-size: 14px;
            color: #333;
        }
        a :hover
        {
            color: Red;
        }
        .goto-top
        {
            display: none;
            text-decoration: none;
        }
        .no-data
        {
            color: #999999;
            padding: 15px;
            display: none;
            font-size: 15px;
        }
        .ranmy
        {
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            font-size: 12px;
            margin-top: 8px;
            color: #8C8A8C;
            box-sizing: border-box;
        }
        .channelType
        {
            display: flex;
            justify-content: space-between;
            align-items: left;
        }
        
        
        .channelType label
        {
            font-size: 14px;
        }
        
        .del
        {
            margin: 5px;
            background-color: #EF9618;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 10px;
            color: white;
            display: inline-block;
            margin-left: 60%;
        }
        
        .success-view-container
        {
            position: fixed;
            top: 0;
            background-color: transparent;
            display: none;
            z-index: 10000;
            background: rgba(0, 0, 0, 0.5);
            width: 100%;
            width: 100%;
            height: 100%;
        }
        
        .success-view
        {
            position: absolute;
            width: 85%;
            top: 50%;
            left: 50%;
            transform: translate(-50% ,-50%);
            background-color: #fff;
            border-radius: 5px;
            padding: 20px 10px;
            text-align: center;
        }
        
        .success-title
        {
            line-height: 30px;
            margin-bottom: 10px;
        }
        
        .success-content
        {
            line-height: 30px;
            margin-bottom: 20px;
        }
        
        .success-btns
        {
            text-align: right;
            display: flex;
            justify-content: center;
        }
        
        .btn
        {
            padding: 9px 5px;
            border-radius: 5px;
            width: 6rem;
        }
        .close
        {
            background-color: white;
            border: 1px solid #0E90D2;
            color: #0E90D2;
            margin-right: 10px;
        }
        
        .copy
        {
            background-color: #0E90D2;
            border: none;
            color: White;
        }
    </style>
    <div class="container">
        <a name="top"></a>
        <div class="search">
            <span>合同查询</span> <span class="btns"><span id="search" class="btn">筛选</span> <span
                class="back btn">返回</span></span>
        </div>
        <div class="mask">
            <div class="filter">
                <div class="rows">
                    <div class="row">
                        <span class="label">开始日期:</span><input class="time-wrapper"  id="startTime" type="date" value="@(DateTime.Now.AddMonths(-3).ToString("yyyy-MM-dd"))"/>
                    </div>
                    <div class="row">
                        <span class="label">结束日期:</span><input class="time-wrapper"  id="endTime" type="date" value="@DateTime.Now.AddDays(1).ToString("yyyy-MM-dd")"/>
                    </div>
                    <div class="row">
                        <span class="label">公司:</span>
                        @Html.DropDownList("companyNo", new SelectList(UserSystem.UserService.SystemDictionaryService.Instance.GetDataList("Company"), "Value", "Name"), "所有")
                    </div>
                    <div class="row">
                        <span class="label">渠道类型:</span>
                        @Html.DropDownList("channelType", new SelectList(UserSystem.UserService.SystemDictionaryService.Instance.GetDataList("ChannelType"), "Value", "Name"), "所有")
                    </div>
                    <div class="row">
                        <span class="label">业务类型:</span>
                        @Html.DropDownList("businessType", new SelectList(UserSystem.UserService.SystemDictionaryService.Instance.GetDataList("BusinessType"), "Value", "Name"), "所有")
                    </div>
                    <div class="row">
                        <span class="label">对方公司名称:</span>
                        <input class="time-wrapper" type="text" id="partnerCompanyName" />
                    </div>
                    <div class="row">
                        <span class="label">备注:</span>
                        <input class="time-wrapper" id="memo" type="text" />
                    </div>
                    <div class="row" style="margin-bottom: 0px;">
                        <span class="buttons">
                            <button class="cancel">
                                取消</button>
                            <button class="ok">
                                确定</button>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="item-container">
        </div>
        <div class="load-more">
            <a href="javascript:void(0)" onclick="getMore()" id="loader">加载更多</a>
        </div>
        <div style="padding: 10px;">
            <a href="#top" class="goto-top">返回顶部</a>
        </div>
        <div>
            <p class="dialogue">
                没有查询到任何数据</p>
        </div>
        <div class="success-view-container">
        <div class="success-view">
            <div class="success-title">
               确认删除合同</div>
            <div class="success-content">
                SCQXSYHF2020041601</div>
            <div class="success-btns">
                <button class="btn close" type="button">
                    取消</button>
                <button class="btn copy" type="button">
                    删除</button>
            </div>
        </div>
    </div>
        <div class="mask1">
    </div>
</body>
</html>
