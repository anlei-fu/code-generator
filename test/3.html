@{ Layout = null; }
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link href="/Content/bootsratp/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="/Content/bootsratp/css/bootstrap-select.min.css" rel="stylesheet" type="text/css" />
    <link href="/Content/bootsratp/css/bootstrap-datetimepicker.min.css" rel="stylesheet"
        type="text/css" />
    <script src="/Scripts/jquery-2.1.4.min.js" type="text/javascript"></script>
    <script src="/Content/bootsratp/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/Content/bootsratp/js/bootstrap-select.min.js" type="text/javascript"></script>
    <script src="/Content/bootsratp/js/defaults-zh_CN.min.js" type="text/javascript"></script>
    <script src="/Content/bootsratp/js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
    @*
    <script src="/Content/bootsratp/js/bootstrap-datetimepicker.js" type="text/javascript"></script>*@
    <script src="/Content/bootsratp/js/locales/bootstrap-datetimepicker.zh-CN.js" type="text/javascript"></script>
    <!-------------------------->
    <script src="/Scripts/jquery.pagination.js" type="text/javascript"></script>
    <script src="/Scripts/jquery.query.js" type="text/javascript"></script>
    <script src="/Scripts/jquery.paging.js" type="text/javascript"></script>
    <!-- 引入 ECharts 文件 -->
    <script src="/Scripts/echarts.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        function MRCenterMsg() {
            this.bind = function () {
                $.paging.config.form = "#query";
                $.paging.bind();
                $("#sub").click(function () {
                    $.paging.submit();
                });
            }
        }
        $(function () {
            var user = new MRCenterMsg();
            user.bind();
            $('.selectpicker').selectpicker({
                noneSelectedText: '请选择',
                countSelectedText: '选择了{0}条记录',
                actionsBox: true,
                deselectAllText: '重置选择',
                selectAllText: '全选',
                width: 150
            });
            $('.selectpicker').selectpicker("refresh");
            $('#face').selectpicker('val', $('#faceVal').val().split(','));
            $('.selectpicker').selectpicker("render");

            $("#StratTime").datetimepicker({
                dateFormat: 'yyyy-mm-dd', //日期显示格式
                timeFormat: 'HH:mm:ss', //时间显示格式
                language: 'zh-CN',
                todayBtn: true,
                autoclose: true,
                orientation: 'bottom',
                minView: 0,
                minuteStep: 1,//分钟间隔1分钟
            });
            $("#EndTime").datetimepicker({
                dateFormat: 'yyyy-mm-dd', //日期显示格式
                timeFormat: 'HH:mm:ss', //时间显示格式
                language: 'zh-CN',
                todayBtn: true,
                autoclose: true,
                orientation: 'bottom',
                minView: 0,
                minuteStep: 1,//分钟间隔1分钟
            });
            $('.selectpicker').selectpicker("refresh");
            var jsondata = $('#jsondata').val();
            var data = $.parseJSON(jsondata);
            var flow = data.flow;
            //            var tel = data.telfee;
            DrawChart(flow, echarts.init($('#flow')[0]), '交易趋势图');
            //            DrawChart(tel, echarts.init($('#telfee')[0]), '话费统计图');
        });

        function sum(arr) {
            if (!arr.length) {
                return 0;
            }
            return eval(arr.join("+"));
        };

        function DrawChart(data, chartobj, title) {
            var orderTime = [], resultMsg = [], total = [];
            if (data != null) {
                var params = [];
                for (var i = 0; i < data.length; i++) {
                    orderTime.push(data[i].ORDERTIME);
                    total.push(data[i].TOTAL);
                    resultMsg.push(data[i].RESULT_MSG);
                    params.push({ "value": data[i].TOTAL, "name": data[i].RESULTMSG });
                    console.log(data[i].RESULTMSG);
                    console.log("TOTAL:" + data[i].TOTAL);
                    console.log(data[i]);
                }
            }
            $('#all1').text(sum(total));

            var option = {
                title:{
                     text: '',
                     subtext: '',
                     x:'center'
                },
                series: [
                {
                    name: '失败原因',
                    type: 'pie',
                    redius: '55%',
                    data: params,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        },
                        normal: {
                            label: {
                                show: true,
                                formatter: '{b} : {c} ({d}%)'
                            },
                            labelLine: { show: true }
                        }
                    }
                }
                ]

            };
            chartobj.setOption(option);
        }



     function renderChart(data,title,id){
       var chart= echarts.init($(`#${id}`)[0])
        var option = {
                title:{
                     text: title,
                     subtext: `总订单${data.length}`,
                     x:'center'
                },
                series: [
                {
                    name: title,
                    type: 'pie',
                    redius: '55%',
                    data: params,
                    itemStyle: {
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        },
                        normal: {
                            label: {
                                show: true,
                                formatter: '{b} : {c} ({d}%)'
                            },
                            labelLine: { show: true }
                        }
                    }
                }
                ]

            };

            chart.setOption(option);
     }

     $(()=>{
          renderChart(JSON.parse($("#ServerIp").val()),"收单Ip统计","serverIp");
          renderChart(JSON.parse($("#RotbotIp").val()),"收单Ip统计","robotIp");
          renderChart(JSON.parse($("#FinishIp").val()),"收单Ip统计","finishIp");
    })
    </script>
    <style>
        #flow /*#telfee*/
        {
            width: 95%;
            height: 700px;
            margin: 0 auto;
            margin-top: 20px;
        }
        
        .top
        {
            width: 100%;
            margin: 0 auto;
            margin-top: 20px;
        }
        
        #query > .form-group:not(:first-child)
        {
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <input type="hidden" value="@ViewData["DataJson"]" id="jsondata" />
     <input type="hidden" value="@ViewData["ServerIp"]" id="ServerIp" />
     <input type="hidden" value="@ViewData["RobotIp"]" id="RobotIp" />
    <input type="hidden" value="@ViewData["FinishIp"]" id="FinishIp" />
    <nav class="top">
        <form id="query" class="form-inline">
        <div class="form-group">
            <label for="time">
                开始时间:
            </label>
            <input type="text" class="form-control" id="StratTime" name="StartTime" readonly value="@DateTime.Now.ToString(" yyyy-MM-dd"+" 00:00")"/>
        </div>
        <div class="form-group">
            <label for="time">
                结束时间:
            </label>
            <input type="text" class="form-control" id="EndTime" name="EndTime" readonly value="@DateTime.Now.ToString(" yyyy-MM-dd HH:mm")"/>
        </div>
         <div class="form-group">
            <label for="TermNo">
                业务类型:
            </label>
            <select id="BusinessType" name="BusinessType" class="selectpicker show-menu-arrow form-control"
                data-live-search="true" data-selected-text-format="count">
                <option value="">请选择</option>
                @foreach (var item in DMSystemDictionaryService.Instance.GetDataStatusList("BusinessType"))
                {
                    <option value="@item.Value">@item.Name</option>
                }
            </select>
        </div>
        <div class="form-group">
            <label for="ProductType">
                产品类型:
            </label>
            <select id="ProductType" name="ProductType" class="selectpicker show-menu-arrow form-control"
                data-live-search="true" data-selected-text-format="count">
                <option value="">请选择</option>
                @foreach (var item in DMSystemDictionaryService.Instance.GetDataStatusList("ProductType"))
                {
                    <option value="@item.Value">@item.Name</option>
                }
            </select>
        </div>
         <div class="form-group">
            <label for="AgentNo">
                代理商:
            </label>
            <select id="AgentNo" name="AgentNo" class="selectpicker show-menu-arrow form-control"
                data-live-search="true" data-selected-text-format="count">
                <option value="">请选择</option>
                @foreach (var item in PutAgentInfoService.Instance.GetDataList())
                {
                    <option value="@item.AgentNo">@item.AgentName</option>
                }
            </select>
        </div>
         <div class="form-group">
            <label for="PromoterId">
                推广人:
            </label>
            <select id="PromoterId" name="PromoterId" class="selectpicker show-menu-arrow form-control"
                data-live-search="true" data-selected-text-format="count">
                <option value="">请选择</option>
                @foreach (var item in DMPromoterInfoService.Instance.GetDataList())
                {
                    <option value="@item.PromoterId">@item.UserName</option>
                }
            </select>
        </div>
        <div class="form-group">
            <label for="TermNo">
                终端名称:
            </label>
            <select id="TermNo" name="TermNo" class="selectpicker show-menu-arrow form-control"
                data-live-search="true" data-selected-text-format="count">
                <option value="">请选择</option>
                @foreach (var item in DMTermInfoService.Instance.GetDataList())
                {
                    <option value="@item.TermNo">@item.TermName</option>
                }
            </select>
        </div>
        <button id="sub" class="btn btn-default" style="width: 100px;margin-top: 10px;margin-left: 5px;">
            查询
        </button>
        </form>
    </nav>
    <div class="container-fluid" style="margin-top: 10px;">
        <div class="row">
            <div  style="padding-right:15px; padding-left:15px; float:left;">
                失败订单数:</div>
            <div  id="all1" style="padding-right:15px; padding-left:15px; float:left;">
            </div>
        </div>
    </div>
    <input type="hidden" id="faceVal" value="@ViewData["FaceVal"]" />
    <!--流量容器-->
    <style>
        .container
        {
            
         }
       #flow
       {
       }
      .right_container
      {
          
      }
      .right_container_item
      {
      }
    </style>
    <div class="container">
     <div id="flow">
    </div>
    <div class="right_container">
       <div id="serverIp" class="right_container_item"></div>
       <div id="robotIp" class="right_container_item"></div>
       <div id="finishIp" class="right_container_item"></div>
    </div>
    </div>
   
    @*
    <!--话费容器-->
    <div id="telfee">
    </div>*@
</body>
</html>