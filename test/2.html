@using MatchingRecharge.Utility
@model MatchingRecharge.ServiceModel.StCommonThresholdConfigListModel
@{
Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="/Content/pagination.css" rel="stylesheet" type="text/css" />
<script src="../../Scripts/Calendar/WdatePicker.js" type="text/javascript"></script>
<script src="/Scripts/jquery.pagination.js" type="text/javascript"></script>
<script src="/Scripts/jquery.query.js" type="text/javascript"></script>
<script src="/Scripts/jquery.paging.js" type="text/javascript"></script>
<script src="../../Scripts/jquery-blockui.js" type="text/javascript"></script>
<script type="text/javascript">
        function MRCenterOrder() {
                this.bind = function () {
                        $.paging.config.form = "#conditionForm";
                        $.paging.bind();
                        $("#ddlps").val($("#ps").val());
                        $("#ddlps").change(function () {
                                $("#ps").val($(this).val());
                        });
                        $(".list_submit").click(function () {
                                $.paging.submit();
                        });
                }
        }

        $(function () {
                var user = new MRCenterOrder();
                user.bind();
        });

        var channelCache = {};


        $(() => {
                $("#ChannelType").change(() => {
                        console.log("changed");
                        var val = $("#ChannelType").val();
                        console.log(val);
                        if (!val)
                                return;
                        if (channelCache[val]) {
                                render1(channelCache[val]);
                                return;
                        }

                        $.ajax({
                                url: "/StCommonThresholdConfig/GetChannelList?channelType=" + val,
                                type: "post",
                                async: false,
                                success: (resp) => {
                                        var result = $.parseJSON(resp);
                                        channelCache[val] = result;
                                        render1();
                                },
                                error: () => {
                                        console.log("faield")
                                }
                        });
                });
        })


        function render1(result) {
                console.log(result);
                $("#ChannelNo").empty();
                $("#ChannelNo").val(null);
                $(`<option>请选择</option>`).appendTo($("#ChannelNo"));
                result.forEach(item => {
                        $(`<option value="${item.ChannelNo}">${item.ChannelName}</option>`).appendTo($("#ChannelNo"));
                });

                $("#conditionForm").find(".js-sSelect").remove();
                $("#conditionForm").find("select").sSelect();
        }

        //删除
        function _delete(id) {
                if (!confirm("你确认要删除该信息吗?"))
                        return;

                $.ajax({
                        type: "post",
                        data: { id: id },
                        url: '/StCommonThresholdConfig/Delete',
                        success: function (data) {
                                data = $.parseJSON(data);
                                alert(data.Message)
                                location.reload();
                        },
                        error: function () {
                                alert("调用失败，请重试");
                        }
                });
        }

        // 添加或编辑
        function add(id, title) {
                console.log("into edit");
                var html = $.ajax({ url: "/StCommonThresholdConfig/item/" + id + "?" + Math.random(), async: false }).responseText;
                art.dialog({
                        content: html,
                        title: title,
                        lock: true,
                        ok: function () {
                                $('#mainForm').submit();
                                return false;
                        },
                        okVal: "提交",
                        cancelVal: "取消",
                        cancel: true
                });
        }

</script>
<div class="order_list">
        <form method="get" id="conditionForm">
                <div class="con_search_box clearfix">
                        <p class="sc_p">
                                渠道类型:
                                <select id="ChannelType">
                                        <option>--请选择--</option>
                                        <option value="1">下游</option>
                                        <option value="2">上游</option>
                                </select>
                        </p>
                        <p class="sc_p">
                                渠道名称:
                                <select id="ChannelNo">
                                        <option>--请选择--</option>
                                </select>
                        </p>
                        <p class="sc_p">
                                阈值类型：
                                @Html.DropDownList("ThresholdType", new
                                SelectList(MatchingRecharge.UserService.DataService.Instance.GetDataList("ThresholdType"),
                                "Value", "Name"), "--请选择--")
                        </p>
                        <p class="sc_p">
                                状态:
                                @Html.DropDownList("Status", new
                                SelectList(MatchingRecharge.UserService.DataService.Instance.GetDataList("Status"),
                                "Value", "Name"), "--请选择--")
                        </p>
                        <p class="sc_p">
                                <input class="list_submit" type="button" />
                                <input type="button" onclick="add('','添加')" class="add_btn hand" />
                        </p>
                </div>
                <input type="hidden" value="0" name="pi" id="pi" />
                <input type="hidden" value="10" name="ps" id="ps" />
                <input type="hidden" value="@Model.TotalCount" id="count" />
        </form>
        <div>
        </div>
        <div class="list_content" id="divshelflist">
                <table width="100%" border="0" cellpadding="0" cellspacing="0" nodata="*">
                        <thead>
                                <tr>
                                        <th>
                                                编号
                                        </th>
                                        <th>
                                                渠道名称
                                        </th>
                                        <th>
                                                渠道类型
                                        </th>
                                        <th>
                                                业务类型
                                        </th>
                                        <th>
                                                充值类型
                                        </th>
                                        <th>
                                                运营商
                                        </th>
                                        <th>
                                                省份
                                        </th>
                                        <th>
                                                地市
                                        </th>
                                        <th>
                                                面值
                                        </th>
                                        <th>
                                                阈值类型
                                        </th>
                                        <th>
                                                阈值
                                        </th>
                                        <th>
                                                时间区间
                                        </th>
                                        <th>
                                                基础值
                                        </th>
                                        <th>
                                                状态
                                        </th>
                                        <th>
                                                更新时间
                                        </th>
                                        <th>
                                                更新人
                                        </th>
                                        <th>
                                                操作
                                        </th>
                                </tr>
                        </thead>
                        <tbody>
                                @foreach (var item in Model.List)
                                {
                                <tr>
                                        <td>@item.ConfigId
                                        </td>
                                        <td>@item.GetDataValue("ChannelName")
                                        </td>
                                        <td>@item.GetDataValue("ChannelTypeName")
                                        </td>
                                        <td>@(item.BusinessType == 0 ? "所有" : item.GetDataValue("BusinessTypeName"))
                                        </td>
                                        <td>@(item.RechargeMode == -1 ? "所有" : item.GetDataValue("RechargeModeName"))
                                        </td>
                                        <td>@(item.CarrierNo == "*" ? "*" : item.GetDataValue("CarrierName"))
                                        </td>
                                        <td>@(item.ProvinceNo == "*" ? "全国" : item.GetDataValue("ProvinceName"))
                                        </td>
                                        <td>@(item.CityNo == "*" ? "*" : item.GetDataValue("CityName"))
                                        </td>
                                        <td>@item.Face
                                        </td>
                                        <td>@item.GetDataValue("ThresholdTypeName")
                                        </td>
                                        <td>@item.Threshold
                                        </td>
                                        <td>@item.TimeInterval
                                        </td>
                                        <td>@item.BaseCntr
                                        </td>
                                        <td>@item.GetDataValue("StatusName")
                                        </td>
                                        <td>@item.UpdateTime
                                        </td>
                                        <td>@item.UpdateUser
                                        </td>
                                        <td>
                                                <a href="javascript:void(0)" onclick="add(@item.ConfigId,'编辑')">编辑</a>
                                                <a href="javascript:void(0)" onclick="_delete(@item.ConfigId)">
                                                        删除</a>
                                        </td>
                                </tr>
                                }
                        </tbody>
                </table>
                <div class="list_number">
                        共 @Model.TotalCount 条记录 | 每页显示:
                        <select id="ddlps">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                        </select>
                        条
                </div>
                <div id="pager" class="list_pager">
                </div>
                <div style="clear: both;">
                </div>
        </div>
</div>
<html>

<head>
        <title>合同生成</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes,height = device-height" />
</head>

<body>
        <script src="/Scripts/jquery-1.4.4.min.js" type="text/javascript"></script>
        <script type="text/javascript">

                $(() => {
                        $(".copy").click(() => {
                                if (copyUtil($(".success-content").text())) {
                                        $(".success-view-container").hide();
                                        $(".mask").hide();
                                        showMsgBox("已拷贝到剪贴板");
                                } else {
                                        showMsgBox("浏览器不支持，请手工拷贝");
                                }

                        });

                        $(".close").click(() => {
                                $(".success-view-container").hide();
                                $(".mask").hide();
                        });

                        console.log($("#date").val());
                        $("#date").val($("#date").val());
                }
                );

                var buttonEnable = true;

                function onSubmitSave() {

                        if (!buttonEnable)
                                return;

                        if (!$("#companyNo").val()) {
                                showMsgBox("请选择公司");
                                return;
                        }

                        if (!$("#businessType").val()) {
                                showMsgBox("请选择业务类型");
                                return;
                        }

                        if (!$("#partnerCompanyName").val()) {
                                showMsgBox("请输入对方公司名称");
                                return;
                        }

                        var data = $("#itemForm").serialize();
                        console.log(data);
                        $.ajax({
                                type: "post",
                                url: "/ContractInfo/Add?" + data,
                                async: false,
                                success: function (resp) {
                                        console.log(resp);
                                        var result = $.parseJSON(resp);
                                        if (result.Status) {
                                                showResult(result.Message);
                                                buttonEnable = false;
                                                $(".create-button").css("backgroud-color", "#525F41");

                                        } else {

                                                showMsgBox(result.Message);
                                        }

                                },
                                error: function (ex) {
                                        showMsgBox("操作失败");
                                        console.log(ex);
                                }

                        });
                }

                function showMsgBox(msg) {
                        $("#msgBoxContent").text(msg);
                        $("#msgBox").show();

                        setTimeout(function () {
                                $("#msgBox").hide();
                        }, 3000);
                }

                function goToQuery() {
                        location.href = "/ContractInfo/Query";
                }

                function showResult(contractNo) {
                        $(".success-content").text(contractNo);
                        $(".success-view-container").show();
                        $(".mask").show();
                }


                function copyUtil(info) {

                        var $textArea = $('<textarea></textarea>');
                        $textArea.val(info);
                        $textArea.css('opacity', '0');
                        $('body').append($textArea);
                        $textArea.select();
                        //通过执行copy指令将选中的信息复制到剪切板
                        var status = document.execCommand('copy', false, null);
                        $textArea.remove();
                        //浏览器不支持copy指令
                        if (!status) {
                                status = prompt('请复制到剪切板', info);
                        }

                        return status;
                }



        </script>
        <style type="text/css">
                html {
                        padding: 0;
                        margin: 0;
                }

                body {
                        background-color: #FFFFFF;
                        padding: 0;
                        margin: 0;
                        height: 100%;
                        width: 100%;
                }

                input.input1[type=datetime-local] {
                        -webkit-appearance: none;
                        outline: none;
                        border: none;
                }

                select {
                        -webkit-appearance: none; //这样select默认的样式就没有了，后面的箭头也没有了，自己找个图标添加进去就可以了
                        padding-right: 30px; //给右边图标留位置
                        background: url("arrow.png") no-repeat scroll right center transparent; //放自己的图标
                }

                .row {
                        margin-top: 18px;
                        font-size: 0;
                }

                .container {
                        width: 90%;
                        margin: 0 auto;
                        @* margin-top: 10%;
                        *@
                }

                .label {
                        padding: 5px;
                        width: 6rem;
                        display: inline-block;
                        color: #7B797B;
                        font-size: 14px;
                        height: 40px;
                        line-height: 40px;
                        text-align: left;
                }

                .text-box {
                        padding: 4px;
                        border-radius: 5px;
                        border: 1px solid #7B797B;
                        width: 67%;
                        margin-left: 0px;
                        box-sizing: border-box;
                }

                select,
                .input1 {
                        width: 67%;
                        display: inline-block;
                        box-sizing: border-box;
                        padding: 4px;
                        border-radius: 5px;
                        border: 1px solid #7B797B;
                        background-color: White;
                        height: 40%;
                        margin-left: 0px;
                        height: 40px;
                        line-height: 40px;
                }

                option {
                        padding: 4px;
                        width: 60%;
                        margin-left: 0px;
                }

                textarea {
                        padding: 4px;
                        width: 60%;
                        margin-left: 0px;
                }

                .header {
                        background-color: #F1F1F1;
                        text-align: center;
                        padding: 10px;
                        border-radius: 4px;
                }

                .text-area {
                        padding: 3px;
                        border-radius: 5px;
                }

                .create-button {
                        width: 95%;
                        line-height: 40px;
                        border-radius: 5px;
                        font-size: 14px;
                        text-align: center;
                        background-color: #5ABA5A;
                        border: none;
                        transition: .5;
                        color: white;
                        text-align: center;
                        margin: 40px auto 0;
                }

                .submit-button {
                        width: 95%;
                        line-height: 40px;
                        border-radius: 5px;
                        font-size: 14px;
                        text-align: center;
                        background-color: #0E90D2;
                        border: none;
                        transition: .5;
                        color: white;
                        text-align: center;
                        margin: 20px auto 0;
                }

                .submit-button :active {
                        background-color: red;
                }

                .msg-box {
                        width: 100%;
                        position: fixed;
                        top: 60%;
                        display: none;
                }

                .msg-box-container {
                        width: 70%;
                        margin: 0 auto;
                        background-color: rgb(35, 35, 35, 0.35);
                        border-radius: 7px;
                }

                .msg-box-content {
                        text-align: center;
                        padding: 8px;
                        font-size: 14px;
                }

                .time-wrapper {
                        display: inline-block !important;
                        min-width: 64% !important;
                        padding: 1px;
                        border-radius: 5px;
                        border: 1px solid #7B797B;
                        background-color: White;
                        text-align: left;
                        box-sizing: border-box;
                        height: 40px;
                        line-height: 40px;
                }

                .time-text-box {
                        padding: 4px;
                        border: none;
                }

                .success-view-container {
                        position: fixed;
                        top: 0;
                        background-color: transparent;
                        display: none;
                        z-index: 10000;
                        background: rgba(0, 0, 0, 0.5);
                        width: 100%;
                        width: 100%;
                        height: 100%;
                }

                .success-view {
                        position: absolute;
                        width: 85%;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background-color: #fff;
                        border-radius: 5px;
                        padding: 20px 10px;
                        text-align: center;
                }

                .success-title {
                        line-height: 30px;
                        margin-bottom: 10px;
                }

                .success-content {
                        line-height: 30px;
                        margin-bottom: 20px;
                }

                .success-btns {
                        text-align: right;
                        display: flex;
                        justify-content: center;
                }

                .btn {
                        padding: 9px 5px;
                        border-radius: 5px;
                        width: 6rem;
                }

                .close {
                        background-color: white;
                        border: 1px solid #0E90D2;
                        color: #0E90D2;
                        margin-right: 10px;
                }

                .copy {
                        background-color: #0E90D2;
                        border: none;
                        color: White;
                }

                .radio-group {
                        width: 67%;
                        display: inline-block;
                        text-align: left;
                }

                .radio-group label {
                        margin-right: 10px;
                        font-size: 14px;
                }

                .mask {
                        position: fixed;
                        background-color: Red;
                }
        </style>
        <form id="itemForm">
                <div class="header">
                        <span class="title">生成合同编号</span>
                </div>
                <div class="container">
                        <div>
                                <div class="row">
                                        <span class="label">日期:</span><input class="time-wrapper input1" id="date"
                                                name="date" type="date" placeholder="请输入时间"
                                                value="@DateTime.Now.ToString(" yyyy-MM-dd")" />
                                </div>
                                <div class="row">
                                        <span class="label">公司:</span>
                                        @Html.DropDownList("companyNo", new
                                        SelectList(UserSystem.UserService.SystemDictionaryService.Instance.GetDataList("Company"),
                                        "Value", "Name"), "请选择")
                                </div>
                                <div class="row">
                                        <span class="label">渠道类型:</span> <span class="radio-group">
                                                <label>
                                                        <input name="channelType" checked="true" type="radio"
                                                                value="SY" />上游</label>
                                                <label>
                                                        <input name="channelType" type="radio" value="XY" />下游
                                                </label>
                                        </span>
                                </div>
                                <div class="row">
                                        <span class="label">业务类型:</span>
                                        @Html.DropDownList("businessType", new
                                        SelectList(UserSystem.UserService.SystemDictionaryService.Instance.GetDataList("BusinessType"),
                                        "Value", "Name"), "请选择")
                                </div>
                                <div class="row">
                                        <span class="label">对方公司名称:</span>
                                        <input class="input1" type="text" id="partnerCompanyName"
                                                name="partnerCompanyName" />
                                </div>
                                <div class="row">
                                        <span class="label" style="vertical-align: top">备注:</span>
                                        <textarea id="memo" name="memo" class="text-box" rows="3"></textarea>
                                </div>
                                <div>
                                        <p class="create-button" onclick="onSubmitSave()">生成</p>
                                        @* <input type="button" value="" /> *@
                                </div>
                                <div>
                                        <p class="submit-button" onclick="goToQuery()">查询</p>
                                        @* <input type="button" class="" value="" onclick="()" /> *@
                                </div>
                        </div>
                </div>
                <div id="msgBox" class="msg-box">
                        <div class="msg-box-container">
                                <p class="msg-box-content" id="msgBoxContent">
                                </p>
                        </div>
                </div>
                <div class="success-view-container">
                        <div class="success-view">
                                <div class="success-title">
                                        生成合同号成功</div>
                                <div class="success-content">
                                        SCQXSYHF2020041601</div>
                                <div class="success-btns">
                                        <button class="btn close" type="button">
                                                关闭</button>
                                        <button class="btn copy" type="button">
                                                复制合同号</button>
                                </div>
                        </div>
                </div>
                <div class="mask">
                </div>
        </form>
</body>

</html>