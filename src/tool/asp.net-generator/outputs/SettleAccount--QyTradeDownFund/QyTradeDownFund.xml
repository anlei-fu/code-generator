<?xml version="1.0" encoding="utf-8" ?>
<config>
  <table name="QY_TRADE_DOWN_FUND">
    <fields>
       <field pname="RecordId" name="RECORD_ID" label="下游变动编号"/>
       <field pname="QyOrderId" name="QY_ORDER_ID" label="记账系统订单号"/>
       <field pname="TradeOrderNo" name="TRADE_ORDER_NO" label="交易系统订单号(激活编号)"/>
       <field pname="ExtOrderNo" name="EXT_ORDER_NO" label="扩展订单号交易(权益卡号)"/>
       <field pname="ExtContractNo" name="EXT_CONTRACT_NO" label="扩展号(合同编号)"/>
       <field pname="ProductName" name="PRODUCT_NAME" label="权益包名称"/>
       <field pname="OrderSource" name="ORDER_SOURCE" label="订单来源（系统编号）"/>
       <field pname="DownChannelNo" name="DOWN_CHANNEL_NO" label="下游渠道编号"/>
       <field pname="DownAccountId" name="DOWN_ACCOUNT_ID" label="下游支付账号"/>
       <field pname="ChangeTime" name="CHANGE_TIME" label="变动创建时间"/>
       <field pname="OrderTime" name="ORDER_TIME" label="订单日期(激活时间)"/>
       <field pname="ChangeType" name="CHANGE_TYPE" label="变更类型"/>
       <field pname="OrderAmount" name="ORDER_AMOUNT" label="订单金额"/>
       <field pname="ChangeAmount" name="CHANGE_AMOUNT" label="变动金额(销售金额)"/>
       <field pname="OrderFace" name="ORDER_FACE" label="订单面值(权益包价值)"/>
       <field pname="ChangeFace" name="CHANGE_FACE" label="变动面值"/>
       <field pname="Balance" name="BALANCE" label="账户余额"/>
       <field pname="Memo" name="MEMO" label="备注"/>
    </fields>
  </table>
  <template>
    <item name="getList">
      <sql>
        <![CDATA[
          SELECT 
                t.*,
                t.*,
                t1.CHANNEL_NAME DownChannelNoName,
                t2.ACCOUNT_NAME DownAccountIdName,
                t3.NAME ChangeTypeName      
          FROM 
            (SELECT RID
                  FROM (SELECT R.RID, ROWNUM LINENUM
                          FROM (SELECT t.rowid RID
                                 FROM  QY_TRADE_DOWN_FUND t
                                 WHERE 
                                      1=1
                                      {&@t.ChangeType}
                                      {&@t.DownAccountId}
                                      {&@t.DownChannelNo}
                                      {&@t.ExtContractNo}
                                      {&@t.ExtOrderNo}
                                      {&@t.TradeOrderNo}
                                   ) R
                           WHERE ROWNUM <= { :PS} * { :PI})
                  WHERE LINENUM > { :PS} * ({ :PI} - 1)) tab
           INNER JOIN QY_TRADE_DOWN_FUND t on tab.rid = t.rowid
           LEFT JOIN QY_BASE_DOWN_CHANNEL t1 ON t.DOWN_CHANNEL_NO = t1.CHANNEL_NO
           LEFT JOIN QY_BASE_DOWN_ACCOUNT t2 ON t.DOWN_ACCOUNT_ID = t2.ACCOUNT_ID
           LEFT JOIN SYSTEM_DICTIONARY t3 ON t.CHANGE_TYPE = t3.VALUE AND t3.TYPE = 'ChangeType'
 
        ]]>
      </sql>
    </item>
    <item name="getCount">
      <sql>
        <![CDATA[
            SELECT 
                  COUNT(1) 
            FROM QY_TRADE_DOWN_FUND  t  
            WHERE 
                 1=1
                 {&@t.ChangeType}
                 {&@t.DownAccountId}
                 {&@t.DownChannelNo}
                 {&@t.ExtContractNo}
                 {&@t.ExtOrderNo}
                 {&@t.TradeOrderNo}                                      
        ]]>
      </sql>
    </item>

  </template>
</config>